CREATE EXTENSION aqo;
SET aqo.mode = 'learn';
SET aqo.show_details = true;
CREATE TABLE t(x int);
INSERT INTO t (x) (SELECT * FROM generate_series(1, 100) AS gs);
ANALYZE t;
EXPLAIN (ANALYZE, VERBOSE, COSTS OFF, TIMING OFF, SUMMARY OFF)
	SELECT x FROM t;
                   QUERY PLAN                   
------------------------------------------------
 Seq Scan on public.t (actual rows=100 loops=1)
   AQO not used
   Output: x
 Using aqo: true
 AQO mode: LEARN
 JOINS: 0
(6 rows)

EXPLAIN (ANALYZE, VERBOSE, COSTS OFF, TIMING OFF, SUMMARY OFF)
	SELECT x FROM t;
                   QUERY PLAN                   
------------------------------------------------
 Seq Scan on public.t (actual rows=100 loops=1)
   AQO: rows=100, error=0%
   Output: x
 Using aqo: true
 AQO mode: LEARN
 JOINS: 0
(6 rows)

-- Check existence of the interface functions.
SELECT obj_description('public.show_cardinality_errors'::regproc::oid);
                                                obj_description                                                
---------------------------------------------------------------------------------------------------------------
 Get cardinality error of queries the last time they were executed. Order queries according to an error value.
(1 row)

SELECT obj_description('public.show_execution_time'::regproc::oid);
                                                                                                             obj_description                                                                                                              
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Get execution time of queries. If controlled = true (AQO could advise cardinality estimations), show time of last execution attempt. Another case (AQO not used), return an average value of execution time across all known executions.
(1 row)

\df show_cardinality_errors
                                                                 List of functions
 Schema |          Name           |                                  Result data type                                  | Argument data types | Type 
--------+-------------------------+------------------------------------------------------------------------------------+---------------------+------
 public | show_cardinality_errors | TABLE(num bigint, id bigint, fshash bigint, error double precision, nexecs bigint) | controlled boolean  | func
(1 row)

\df show_execution_time
                                                                 List of functions
 Schema |        Name         |                                    Result data type                                    | Argument data types | Type 
--------+---------------------+----------------------------------------------------------------------------------------+---------------------+------
 public | show_execution_time | TABLE(num bigint, id bigint, fshash bigint, exec_time double precision, nexecs bigint) | controlled boolean  | func
(1 row)

DROP EXTENSION aqo;
